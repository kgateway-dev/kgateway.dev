---
name: New release
about: Update the docs for a minor version release
title: 'Doc release for version <x.x.x>'
labels: 'documentation'
assignees: ''

---

> [!CAUTION]  
> Don't open a doc release PR too early! The release PR makes changes to the doc directories that content is published in. Therefore, in-progress doc PRs can be impacted. If those PRs update mostly only reuse files in the assets/docs directory, the impact is probably not as large, but they might need to update version tags or the content/docs skeleton pages that call the reuse files. 

## Pre-release

- [ ] Confirm that the upgrade and release note pages are updated. Typically, this is a separate issue.
- [ ] In `content/docs`, create the new `main` by making a copy of the current main directory. Rename the directories appropriately. For example, the old main is copied to a new `main`, the old main becomes `latest`, and the old latest becomes a `2.x.x` version.
- [ ] In the `hugo.yaml` file, update the `versions` to include the new minor version as main, the previous main as latest, and the previous latest as its version.
- [ ] Retire any version older than `n-3` (remove the directory and version from the `hugo.yaml` file)
- [ ] Update the version conrefs in the `assets/docs/versions` directory. Often, there is not a release for the next version, so you might have to use the same for latest and main.
- [ ] Add the release date to the version table in `assets/docs/pages/reference/versions.md`, and remove any retired versions.
- [ ] Update the version shortcodes to include the newest version. For example, if 2.2.x is the latest release, search for `version include-if="2.1.x"` to add `version include-if="2.2.x,2.1.x"`. Keep in mind that the include-if might start with different versions, like `include-if="2.0.x,2.1.x,2.2.x"` so do a few searches.
  - Example find and replacements for a hypothetical 2.8 release
    1. `"2.8.x,` > `"2.9.x,2.8.x,`
    2. `,2.8.x"` > `,2.8.x,2.9.x"`
    3. `"2.8.x"` > `"2.9.x,2.8.x"`
    4. `"2.4.x,` > `"`
    5. `,2.4.x"` > `"`
    6. Delete any content that is in `"2.4.x"` only tags (older than n-3)
    7. For anything that is now in `"2.9.x,2.8.x,2.7.x,2.6.x,2.5.x"` or `"2.5.x,2.6.x,2.7.x,2.8.x,2.9.x"` tags, keep the content but delete the version tags surrounding it
- [ ] Update any hard-coded instances of `kgateway.dev/docs/latest/` URLs in version-specific pages, such as the release notes. For example, 2.0 release notes no longer go to `/latest/` URLs but to `/2.0.x/` URLs.
- [ ] Search content for any hard-coded instances of the version, like `2.1`, as well as any retired versions, and update if needed. Example pages are upgrade, version skew, and reference pages.
- [ ] Start the [update-api-docs.yml workflow](https://github.com/kgateway-dev/kgateway.dev/actions/workflows/update-api-docs.yml) to generate the reference docs for the new release.

## Post-release

- [ ] Merge in the autogenerated PR that the workflow created
- [ ] Verify that the docs are published
- [ ] Cut a GitHub release of the docs repo for the new release, and include any retired version (such as `Release for 2.6.x and last state for retired 2.2.x`)